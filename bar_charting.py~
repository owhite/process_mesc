#! /usr/bin/env python3

import sys, getopt
import pandas as pd
import matplotlib.pyplot as plt
import numpy as np
import parse_data # helper script

# {"adc1":740,"ehz":0.161,"error":0,"id":0.197,"iq":0.094,"iqreq":0.000,"TMOS":0.000,"TMOT":0.000,"vbus":72.481,"Vd":1.928,"Vq":0.586},

try:
    opts, args = getopt.getopt(sys.argv[1:],"i:",["ifile="])
except getopt.GetoptError:
    print ('program.py -i <inputfile>')
    sys.exit(2)

fname = ""

for opt, arg in opts:
    if opt in ("-i", "--infile"):
        fname = arg

the_page = parse_data.get_json_file(fname)
title = the_page['title']

data = parse_data.make_frame(the_page['data'])
df = pd.DataFrame(data)
df_scaled = df.copy()

df['phaseA'] = np.sqrt( (df['id'] * df['id']) + (df['iq'] * df['iq']) )

column = 'adc1'
max = the_page['max_vals'][column]
min = the_page['min_vals'][column]
print(max, min)

df_scaled[column] = (df_scaled[column] - min) / (max - min) 

y = the_page['bar_displays']
for x in the_page['bar_displays']:
    if y[x]:
        print (x)

data_max_vals = df.max(axis = 0)

data_length = len(df) - 1

print (data_max_vals)
print (data_length)


